<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="planktoscopeR">
<title>Analyse Planktoscope data • planktoscopeR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analyse Planktoscope data">
<meta property="og:description" content="planktoscopeR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">planktoscopeR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/vignette.html">Analyse Planktoscope data</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Analyse Planktoscope data</h1>
            
      
      
      <div class="d-none name"><code>vignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This is an example of usage of this package on a small dataset, <code>global.tsv</code>. This tsv file contains 8 samples, from 3 different nets.</p>
</div>
<div class="section level2">
<h2 id="analyses">Analyses<a class="anchor" aria-label="anchor" href="#analyses"></a>
</h2>
<div class="section level3">
<h3 id="import-data">Import data<a class="anchor" aria-label="anchor" href="#import-data"></a>
</h3>
<p>The first step is to import the tsv file in R. To do so, we use the function <code><a href="../reference/import.data.html">import.data()</a></code>. We decide to omit the categories <code>"not-ling"</code>, <code>"duplicate"</code> and <code>"multiple"</code> we consider as not relevant for the analysis.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">toy_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"global.tsv.gz"</span>, package <span class="op">=</span> <span class="st">"planktoscopeR"</span><span class="op">)</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import.data.html">import.data</a></span><span class="op">(</span><span class="va">toy_dataset</span>,
                    unwanted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"not-living"</span>,<span class="st">"duplicate"</span>,<span class="st">"multiple"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Then we aggregate the data per category with the function <code><a href="../reference/get.counts.and.vol.html">get.counts.and.vol()</a></code>. It basically consists in counting objects and summing volumes.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_distrib</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.counts.and.vol.html">get.counts.and.vol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></code></pre></div>
<p>We also extract the information related to the samples with the function <code><a href="../reference/get.info.html">get.info()</a></code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">context</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.info.html">get.info</a></span><span class="op">(</span><span class="va">data</span>,type<span class="op">=</span><span class="st">"sample"</span><span class="op">)</span></code></pre></div>
<p>We can now start to analyse data.</p>
</div>
<div class="section level3">
<h3 id="taxonomic-composition">Taxonomic composition<a class="anchor" aria-label="anchor" href="#taxonomic-composition"></a>
</h3>
<p>A quick way to have an overview of the taxonomic composition of our sample is to produce barcharts coloured by taxonomic groups.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">data_distrib</span>,<span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">sample_id</span>,y<span class="op">=</span><span class="va">biovolume</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill<span class="op">=</span><span class="va">category</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;"></p>
<p>That plot doesn’t look good. Let’s tune it a bit!</p>
<p>We use the function <code><a href="../reference/plot_categ.html">plot_categ()</a></code> to limit the number of categories (colours) to 9…</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_categ.html">plot_categ</a></span><span class="op">(</span><span class="va">data_distrib</span>,<span class="st">"category"</span>,<span class="st">"biovolume"</span><span class="op">)</span></code></pre></div>
<p>add change the colour palette <code>scale_fill_brewer()</code>, change the theme with <code>theme_bw()</code> and rotate the x axis labels</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">taxoplot_biov</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">data_distrib</span>,<span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">sample_id</span>,y<span class="op">=</span><span class="va">biovolume</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill<span class="op">=</span><span class="va">category_plot</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_discrete</span><span class="op">(</span>guide <span class="op">=</span> <span class="fu">guide_axis</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span>

<span class="va">taxoplot_biov</span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We observe big differences in term of total biovolume, but it is hard to see the differences in composition. Using the option <code>position="fill"</code> in <code>geom_col</code> you have all the bars at the same height facilitating the comparison.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">taxoplot_biov_total</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">data_distrib</span>,<span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">sample_id</span>,y<span class="op">=</span><span class="va">biovolume</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill<span class="op">=</span><span class="va">category_plot</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"black"</span>,position<span class="op">=</span><span class="st">"fill"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_discrete</span><span class="op">(</span>guide <span class="op">=</span> <span class="fu">guide_axis</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span>

<span class="va">taxoplot_biov_total</span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="beta_diversity">Beta_diversity<a class="anchor" aria-label="anchor" href="#beta_diversity"></a>
</h3>
<p>For this section we will use functions from the library <a href="https://cran.r-project.org/web/packages/vegan/" class="external-link">vegan</a> which contains most of the functions you need to do community ecology analysis.</p>
<p>Beta diversity is the ratio between local diversity (alpha diversity) and regional diversity (gamma diversity). Beta diversity is often estimated measuring the species composition rate of variation. In other words, it is how much the species composition between two samples varies.</p>
<p>We will use Bray-Curtis dissimilarity, one of the most popular dissimilarity measures in ecology, to compare the samples.</p>
<p>First we transform the count table in a format we can directly use with the functions from the library vegan.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">biovolume_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.df.vegan.html">get.df.vegan</a></span><span class="op">(</span><span class="va">data_distrib</span>,<span class="st">"biovolume"</span><span class="op">)</span></code></pre></div>
<p>We compute Bray-Curtis dissimilarities on biovolumes.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d.bray</span> <span class="op">&lt;-</span> <span class="fu">vegdist</span><span class="op">(</span><span class="va">biovolume_df</span><span class="op">)</span></code></pre></div>
<p>To be able to visualize the dissimilarities (beta diversity) in two dimension we perform a Principal Coordinates Analysis (PCoA).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pcoa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cmdscale.html" class="external-link">cmdscale</a></span><span class="op">(</span><span class="va">d.bray</span>,k<span class="op">=</span><span class="fl">2</span>,eig<span class="op">=</span><span class="cn">T</span><span class="op">)</span></code></pre></div>
<p>We extract the results and link them with the sample description…</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pcoa.plot</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">biovolume_df</span><span class="op">)</span>,
                        PCo1<span class="op">=</span><span class="va">pcoa</span><span class="op">$</span><span class="va">points</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,
                        PCo2<span class="op">=</span><span class="va">pcoa</span><span class="op">$</span><span class="va">points</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="va">pcoa.plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">pcoa.plot</span>,<span class="va">context</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">id</span>,<span class="va">sampling_gear</span><span class="op">)</span><span class="op">]</span>,by<span class="op">=</span><span class="st">"id"</span><span class="op">)</span></code></pre></div>
<p>and visualize the results using ggplot2. We plot on top of the PCoA the taxonomic composition barcharts (biovolumes).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pcoa_biov</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">pcoa.plot</span>,<span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">PCo1</span>,y<span class="op">=</span><span class="va">PCo2</span>,color<span class="op">=</span><span class="va">sampling_gear</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label<span class="op">=</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="st">"PCoA on biovolumes"</span>,
         x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"PCo1 "</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">pcoa</span><span class="op">$</span><span class="va">eig</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pcoa</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span><span class="op">)</span>,<span class="st">" %"</span><span class="op">)</span>,
         y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"PCo2 "</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">pcoa</span><span class="op">$</span><span class="va">eig</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pcoa</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span><span class="op">)</span>,<span class="st">" %"</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>plot.title.position<span class="op">=</span><span class="st">"panel"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">coord_fixed</span><span class="op">(</span><span class="op">)</span>

<span class="va">taxoplot_biov</span><span class="op">/</span><span class="va">pcoa_biov</span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We observe that most of the beta diversity is due to differences in total biovolumes.</p>
<p>As it is frequent to have problems with the calculation of filtered volumes, it is worth analysing <strong>standardized biovolumes</strong>.</p>
<p>To do so, we standardized the data with the function <code><a href="https://rdrr.io/pkg/vegan/man/decostand.html" class="external-link">vegan::decostand()</a></code></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">biovolume_df_total</span> <span class="op">&lt;-</span> <span class="fu">decostand</span><span class="op">(</span><span class="va">biovolume_df</span>,method <span class="op">=</span> <span class="st">"total"</span><span class="op">)</span></code></pre></div>
<p>Then, the analysis is the same as before.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d.bray</span><span class="op">&lt;-</span><span class="fu">vegdist</span><span class="op">(</span><span class="va">biovolume_df_total</span><span class="op">)</span>
<span class="va">pcoa</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/cmdscale.html" class="external-link">cmdscale</a></span><span class="op">(</span><span class="va">d.bray</span>,k<span class="op">=</span><span class="fl">2</span>,eig<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="va">pcoa.plot</span><span class="op">&lt;-</span><span class="fu">data.table</span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">biovolume_df_total</span><span class="op">)</span>,PCo1<span class="op">=</span><span class="va">pcoa</span><span class="op">$</span><span class="va">points</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,PCo2<span class="op">=</span><span class="va">pcoa</span><span class="op">$</span><span class="va">points</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="va">pcoa.plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">pcoa.plot</span>,<span class="va">context</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">id</span>,<span class="va">sampling_gear</span><span class="op">)</span><span class="op">]</span>,by<span class="op">=</span><span class="st">"id"</span><span class="op">)</span>

<span class="va">pcoa_biov_total</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">pcoa.plot</span>,<span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">PCo1</span>,y<span class="op">=</span><span class="va">PCo2</span>,color<span class="op">=</span><span class="va">sampling_gear</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_text_repel</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label<span class="op">=</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="st">"PCoA on biovolumes"</span>,
         x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"PCo1 "</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">pcoa</span><span class="op">$</span><span class="va">eig</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pcoa</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span><span class="op">)</span>,<span class="st">" %"</span><span class="op">)</span>, <span class="co"># percentage explained by the first component</span>
         y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"PCo2 "</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">pcoa</span><span class="op">$</span><span class="va">eig</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pcoa</span><span class="op">$</span><span class="va">eig</span><span class="op">)</span><span class="op">)</span>,<span class="st">" %"</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>plot.title.position<span class="op">=</span><span class="st">"panel"</span><span class="op">)</span>

<span class="va">taxoplot_biov_total</span><span class="op">/</span><span class="va">pcoa_biov_total</span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Now we see that the difference are mostly explained by the sampling gear used.</p>
</div>
<div class="section level3">
<h3 id="nbss-plots">NBSS plots<a class="anchor" aria-label="anchor" href="#nbss-plots"></a>
</h3>
<p>You can also show NBSS plots. These correspond to the normalized biomass size spectra.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># </span>
<span class="va">sample_selection</span> <span class="op">&lt;-</span> <span class="va">context</span><span class="op">[</span><span class="va">sampling_gear</span><span class="op">==</span><span class="st">"net_hsn"</span>,<span class="va">id</span><span class="op">]</span>
<span class="va">data_selection</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">sample_id</span><span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span><span class="va">sample_selection</span><span class="op">]</span>

<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">data_selection</span>,by<span class="op">=</span><span class="st">"sample_id"</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="../reference/NBSS.plot.html">NBSS.plot</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">wrap_plots</span><span class="op">(</span><span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>,nrow <span class="op">=</span> <span class="fl">4</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="vignette_files/figure-html/unnamed-chunk-15-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Clara Trellu, Nicolas Henry.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
